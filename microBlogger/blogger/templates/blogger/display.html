{% extends 'blogger/base.html' %}
{% load staticfiles%}

{% block javascript %}
    <script>
    $(".btn").click(function () {
      var blog_id = $(this).attr("data-catid")
      var comment_text = $("#cmnt"+ blog_id).val()
      $.ajax({

                type: "GET",
                url: "{% url 'blogger:comment' %}",
                data: {
                    'blog_id': blog_id,
                    'comment_text': comment_text,
                },
                dataType: 'json',
                success: function(commentJson) {
                  console.log(commentJson)
                  var user_name = commentJson.user
                  var content = commentJson['comment_txt']
                  if (content != '' )
                  {
                    $("#comments_list"+blog_id).append(
                      $('<li/>').append(
                        $( '<h6/>' , { text : user_name+ " :" } )
                      )
                      .append(
                        $( '<span/>' , { text : content })
                      )
                    );
                    $("#cmnt"+ blog_id).val("");
                  }
                }
            });



    });
    </script>






{% endblock %}



{% block body_block %}
    <div class="jumbotron">
        <p align="right"><a href="{% url 'blogger:create' %}"><u>Create New Post!</u></a><p>
        <h1>POSTS</h1><br>
        {% if blogs %}
          {% for b in blogs %}
            <h5>{{ b.username }}</h5>
            <p>{{ b.content }}</p>
              {% if comments %}
              <ul id = "comments_list{{b.pk}}">
                {% for c in comments %}
                  {% if b == c.blogtext %}
                    <li><h6>{{ c.username }} :</h6>{{ c.content }}</li>
                  {% endif %}
                {% endfor %}
              </ul>
              <ul>
                  <form method="post">
                    {% csrf_token %}
                    <input type="text" class ="cmnt" name="comment" id='cmnt{{b.pk}}' placeholder="Add comment">
                    <input type="button" class="btn btn-primary" value="Comment" id = "comment{{b.pk}}" data-catid="{{ b.pk }}">
                  </form>
              </ul>
              {% endif %}
              <br>
          {% endfor %}
        {% else %}
          <p>NO BLOGS YET!!</p>
        {% endif %}
    </div>
{% endblock %}
